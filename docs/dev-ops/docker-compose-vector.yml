version: '3'
services:
  vector_db:
    # ä¾ç„¶ä½¿ç”¨å°å‚…å“¥æä¾›çš„é•œåƒï¼Œå› ä¸ºè¿™é‡Œé¢å·²ç»é¢„è£…å¥½äº† pgvector æ’ä»¶ï¼Œå¼€ç®±å³ç”¨
    image: pgvector/pgvector:pg16
    container_name: vector_db
    restart: always
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=ai-rag-knowledge  # æ•°æ®åº“åå« springai
    volumes:
      # âš ï¸ å…³é”®ç‚¹ï¼šè¯·ç¡®è®¤ä½ æœ¬åœ°è¿™ä¸ª init.sql æ–‡ä»¶çš„è·¯å¾„æ˜¯å¯¹çš„
      # å¦‚æœä½ çš„ sql æ–‡ä»¶åœ¨ docs/dev-ops/environment/... è®°å¾—ä¿®æ”¹ä¸‹é¢å†’å·å·¦è¾¹çš„è·¯å¾„
      - ./pgvector/sql/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      # ğŸš€ é‡ç‚¹ä¿®æ”¹åœ¨è¿™é‡Œï¼ï¼ï¼
      # å·¦è¾¹æ˜¯å®¿ä¸»æœº(Mac)ç«¯å£ï¼Œå³è¾¹æ˜¯å®¹å™¨ç«¯å£
      # æ”¹æˆ 5433ï¼Œè¿™æ ·å°±ä¸ä¼šè·Ÿä½ æœ¬åœ°è¯¾ç¨‹ç”¨çš„ Postgres(5432) æ‰“æ¶äº†
      - '5433:5432'
    healthcheck:
      # åŸé…ç½®é‡Œè¿™é‡Œå†™çš„æ˜¯ vector_storeï¼Œä½†ç¯å¢ƒå˜é‡æ˜¯ springaiï¼Œä¼šå¯¼è‡´ä¸€ç›´ unhealthy
      # æˆ‘å¸®ä½ æ”¹æˆ springai äº†
      test: "pg_isready -U postgres -d ai-rag-knowledge"
      interval: 2s
      timeout: 20s
      retries: 10